<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lab 8.2 - IPC Communication Demo</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    .container { max-width: 900px; margin: 0 auto; background: rgba(255, 255, 255, 0.1); padding: 30px; border-radius: 15px; backdrop-filter: blur(10px); }
    .header { text-align: center; margin-bottom: 30px; }
    .demo-section { background: rgba(255, 255, 255, 0.1); padding: 20px; border-radius: 10px; margin-bottom: 20px; }
    .input-group { margin: 15px 0; }
    .input-group label { display: block; margin-bottom: 5px; font-weight: bold; }
    .input-group input { width: 100%; padding: 10px; border: none; border-radius: 5px; font-size: 16px; box-sizing: border-box; }
    .button { background: rgba(255,255,255,0.2); border:2px solid white; color:white; padding:12px 24px; border-radius:25px; cursor:pointer; font-size:16px; margin:10px 5px; transition: all 0.3s ease;}
    .button:hover { background:white; color:#667eea; transform: translateY(-2px); }
    .result-box { background: rgba(0,0,0,0.2); padding:15px; border-radius:8px; margin-top:15px; font-family: monospace; white-space: pre-wrap; max-height:200px; overflow-y:auto; }
    .loading { color:#ffd700; font-style:italic; }
    .success { color:#90ee90; }
    .error { color:#ff6b6b; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ”„ IPC Communication Demo</h1>
      <p>à¸à¸²à¸£à¸ªà¸·à¹ˆà¸­à¸ªà¸²à¸£à¸£à¸°à¸«à¸§à¹ˆà¸²à¸‡ Main Process à¹à¸¥à¸° Renderer Process</p>
    </div>

    <!-- Demo 1: à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸à¸·à¹‰à¸™à¸à¸²à¸™ -->
    <div class="demo-section">
      <h3>ğŸ“¤ Demo 1: à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¹„à¸› Main Process</h3>
      <div class="input-group">
        <label>à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸ªà¹ˆà¸‡:</label>
        <input type="text" id="messageInput" placeholder="à¸à¸´à¸¡à¸à¹Œà¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸—à¸µà¹ˆà¸™à¸µà¹ˆ..." value="Hello from Renderer Process!">
      </div>
      <button class="button" onclick="sendMessage()">ğŸ“¤ à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡</button>
      <button class="button" onclick="clearResult('messageResult')">ğŸ§¹ à¹€à¸„à¸¥à¸µà¸¢à¸£à¹Œ</button>
      <div class="result-box" id="messageResult">à¸à¸”à¸›à¸¸à¹ˆà¸¡ "à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡" à¹€à¸à¸·à¹ˆà¸­à¸—à¸”à¸ªà¸­à¸š IPC</div>
    </div>

    <!-- Demo 2: à¸£à¸°à¸šà¸šà¸—à¸±à¸à¸—à¸²à¸¢ -->
    <div class="demo-section">
      <h3>ğŸ‘‹ Demo 2: à¸£à¸°à¸šà¸šà¸—à¸±à¸à¸—à¸²à¸¢ Agent</h3>
      <div class="input-group">
        <label>à¸Šà¸·à¹ˆà¸­ Agent:</label>
        <input type="text" id="agentName" placeholder="à¹ƒà¸ªà¹ˆà¸Šà¸·à¹ˆà¸­à¸‚à¸­à¸‡à¸„à¸¸à¸“..." value="Agent001">
      </div>
      <button class="button" onclick="sayHello()">ğŸ‘‹ à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸š</button>
      <button class="button" onclick="clearResult('helloResult')">ğŸ§¹ à¹€à¸„à¸¥à¸µà¸¢à¸£à¹Œ</button>
      <div class="result-box" id="helloResult">à¸à¸”à¸›à¸¸à¹ˆà¸¡ "à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸š" à¹€à¸à¸·à¹ˆà¸­à¸—à¸”à¸ªà¸­à¸šà¸£à¸°à¸šà¸šà¸—à¸±à¸à¸—à¸²à¸¢</div>
    </div>

    <!-- Demo 3: Agent Wallboard -->
    <div class="demo-section">
      <h3>ğŸ“Š Demo 3: Agent Wallboard Functions</h3>
      <button class="button" onclick="loadAgents()">ğŸ“Š à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ Agents</button>
      <button class="button" onclick="showStatusSelector()">ğŸ”„ à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸ªà¸–à¸²à¸™à¸°</button>
      <button class="button" onclick="clearResult('agentResult')">ğŸ§¹ à¹€à¸„à¸¥à¸µà¸¢à¸£à¹Œ</button>

      <div id="statusSelector" style="display:none; margin:15px 0;">
        <select id="agentSelect" style="padding:8px; margin-right:10px;"><option value="">à¹€à¸¥à¸·à¸­à¸ Agent</option></select>
        <select id="statusSelect" style="padding:8px; margin-right:10px;">
          <option value="Available">Available</option>
          <option value="Busy">Busy</option>
          <option value="Break">Break</option>
          <option value="Offline">Offline</option>
        </select>
        <button class="button" onclick="changeStatus()">âœ… à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™</button>
      </div>
      <div class="result-box" id="agentResult">à¸à¸”à¸›à¸¸à¹ˆà¸¡ "à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ Agents" à¹€à¸à¸·à¹ˆà¸­à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™</div>
    </div>
  </div>

  <script>
    console.log('ğŸ¨ [RENDERER] à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸”...');

    if (!window.electronAPI) console.error('âŒ [RENDERER] electronAPI à¹„à¸¡à¹ˆà¸à¸£à¹‰à¸­à¸¡à¹ƒà¸Šà¹‰à¸‡à¸²à¸™');

    let agentsData = null;

    function displayResult(elementId, data, type='info') {
      const element = document.getElementById(elementId);
      const timestamp = new Date().toLocaleTimeString('th-TH');
      let content = (typeof data === 'object') ? JSON.stringify(data, null, 2) : data.toString();
      element.innerHTML = `[${timestamp}] ${content}`;
      element.className = `result-box ${type}`;
    }

    async function sendMessage() {
      const msg = document.getElementById('messageInput').value.trim();
      if (!msg) return displayResult('messageResult','à¸à¸£à¸¸à¸“à¸²à¹ƒà¸ªà¹ˆà¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡','error');
      displayResult('messageResult','à¸à¸³à¸¥à¸±à¸‡à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡...','loading');
      try {
        const response = await window.electronAPI.sendMessage(msg);
        displayResult('messageResult', response,'success');
      } catch(e) { displayResult('messageResult', `Error: ${e.message}`,'error'); }
    }

    async function sayHello() {
      const name = document.getElementById('agentName').value.trim();
      if (!name) return displayResult('helloResult','à¸à¸£à¸¸à¸“à¸²à¹ƒà¸ªà¹ˆà¸Šà¸·à¹ˆà¸­ Agent','error');
      displayResult('helloResult','à¸à¸³à¸¥à¸±à¸‡à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸š...','loading');
      try {
        const res = await window.electronAPI.sayHello(name);
        const text = `ğŸ‰ à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸šà¸ªà¸³à¹€à¸£à¹‡à¸ˆ!\n\nğŸ‘¤ Agent: ${res.name}\nğŸ’¬ à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡: ${res.greeting}\nâ° à¹€à¸§à¸¥à¸²: ${res.time}\nğŸ‘¥ Agents à¸­à¸­à¸™à¹„à¸¥à¸™à¹Œ: ${res.agentCount}\nâœ… à¸à¸£à¹‰à¸­à¸¡à¸—à¸³à¸‡à¸²à¸™à¹à¸¥à¹‰à¸§!`;
        displayResult('helloResult', text, 'success');
      } catch(e){ displayResult('helloResult', `Error: ${e.message}`,'error'); }
    }

    async function loadAgents() {
      displayResult('agentResult','à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ agents...','loading');
      try {
        const res = await window.electronAPI.getAgents();
        if(!res.success) throw new Error(res.error);
        agentsData = res.data;
        displayAgentData(agentsData);
        updateAgentSelector(agentsData.agents);
      } catch(e){ displayResult('agentResult', `Error: ${e.message}`,'error'); }
    }

    function displayAgentData(data){
      const stats = data.statistics;
      const list = data.agents.map(a=>{
        const emoji = {'Available':'ğŸŸ¢','Busy':'ğŸ”´','Break':'ğŸŸ¡','Offline':'âš«'}[a.status]||'â“';
        return `${emoji} ${a.name} (${a.id}) ğŸ“ Ext:${a.extension} ğŸ¢ ${a.department} ğŸ“Š Calls:${a.totalCalls} â±ï¸ Avg:${a.avgCallTime}s`;
      }).join('\n\n');
      const text = `ğŸ“Š AGENT WALLBOARD DATA\n======================\nğŸ‘¥ AGENTS (${stats.totalAgents} à¸„à¸™):\n${list}\nğŸ“ˆ STATISTICS:\nğŸŸ¢ Available: ${stats.availableAgents}\nğŸ”´ Busy: ${stats.busyAgents}\nğŸŸ¡ Break: ${stats.onBreakAgents}\nğŸ“ Total Calls Today: ${stats.totalCallsToday}\nâ° Avg Wait Time: ${stats.avgWaitTime}s\nâ° Last Updated: ${new Date().toLocaleString('th-TH')}`;
      displayResult('agentResult', text,'success');
    }

    function updateAgentSelector(agents){
      const sel = document.getElementById('agentSelect');
      sel.innerHTML='<option value="">à¹€à¸¥à¸·à¸­à¸ Agent</option>';
      agents.forEach(a=>{
        const opt = document.createElement('option');
        opt.value=a.id;
        opt.textContent=`${a.name} (${a.id}) - ${a.status}`;
        sel.appendChild(opt);
      });
    }

    function showStatusSelector(){
      if(!agentsData) return displayResult('agentResult','à¸à¸£à¸¸à¸“à¸²à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ agents à¸à¹ˆà¸­à¸™','error');
      const sel = document.getElementById('statusSelector');
      sel.style.display = sel.style.display==='none'?'block':'none';
    }

    async function changeStatus(){
      const id = document.getElementById('agentSelect').value;
      const status = document.getElementById('statusSelect').value;
      if(!id||!status) return displayResult('agentResult','à¸à¸£à¸¸à¸“à¸²à¹€à¸¥à¸·à¸­à¸ Agent à¹à¸¥à¸° Status','error');
      displayResult('agentResult',`à¸à¸³à¸¥à¸±à¸‡à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸ªà¸–à¸²à¸™à¸° ${id}...`,'loading');
      try{
        const res = await window.electronAPI.changeAgentStatus(id,status);
        if(!res.success) throw new Error(res.error);
        const text = `âœ… à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸ªà¸–à¸²à¸™à¸°à¸ªà¸³à¹€à¸£à¹‡à¸ˆ!\n\nğŸ‘¤ Agent: ${res.agent.name} (${res.agent.id})\nğŸ”„ Status: ${res.agent.status}\nâ° à¹€à¸§à¸¥à¸²: ${new Date(res.agent.lastStatusChange).toLocaleString('th-TH')}\n${res.message}`;
        displayResult('agentResult', text,'success');
        setTimeout(loadAgents,2000);
      } catch(e){ displayResult('agentResult', `Error: ${e.message}`,'error'); }
    }

    function clearResult(id){
      const el=document.getElementById(id);
      el.innerHTML='à¹€à¸„à¸¥à¸µà¸¢à¸£à¹Œà¹à¸¥à¹‰à¸§...';
      el.className='result-box';
    }

    document.getElementById('messageInput').addEventListener('keypress', e=>{ if(e.key==='Enter') sendMessage(); });
    document.getElementById('agentName').addEventListener('keypress', e=>{ if(e.key==='Enter') sayHello(); });

    window.addEventListener('DOMContentLoaded',()=>console.log('ğŸ“„ [RENDERER] HTML à¹‚à¸«à¸¥à¸”à¹€à¸ªà¸£à¹‡à¸ˆ'));
    window.addEventListener('load',()=>console.log('âœ… [RENDERER] à¸—à¸¸à¸à¸­à¸¢à¹ˆà¸²à¸‡à¸à¸£à¹‰à¸­à¸¡à¹à¸¥à¹‰à¸§'));
  </script>
</body>
</html>
